## Предефиниране на оператори

- C++ позволява на програмистите да задават ново значение на функционалност на знаците за операции  
**предефиниране на оператори**

**Ползи**
- По-лесно и по-интуитивно за иползване е прилагането на операция, а не извикване на функция
- Позволяват по-сбито извикване (без да се използват скоби при изпълнението на операцията)  
  
**Ограничения**
- Предефинирането е позволено, само ако поне един от операндите е обект от клас
- Не се допуска предефиниране на операции между стандартни типове, например операцията + между два int,  
тъй като това би променило смисъла (семантиката) на операцията

## Видове оператори

**Операциите са**
- Унарни - с един операнд, например **!b**
- Бинарни - с два операнда, например **a + c**

**Всяка операция се характеризира с**
- Позиция на знака спрямо операнда или операндите му
- Приоритет
- Асоцииране на последователни операции

## Позволени оператори за предефиниране

| + | - | * | / | % | ^ | & |
| - | - | - | - | - | - | - |
| \| | ~ | ! | = | < | > | += | 
| -= | \*= | /= | %= | ^= | &= | \|= |
| << | >> | >>= | <<= | == | != | <= |
| >= | && | \|\| | ++ | -- | ->* | , |
| -> | [] | () | new | new[] | delete | delete[] |

## Видове оператори

**Позицията** на операторите спрямо операнда го определя като
- Префиксен **++a**
- Инфиксен **a + c**
- Постфиксен **a++**  
   
- **Приоритетът** на операциите определя реда на тяхното изпълнение в израз
- **Асоциирането** на операциите определя реда на изпълнение на последователно записани операции с еднакъв приоритет

**Видове оператори спрямо асоциативността** (C++)
- **Ляво асоциативни** - изпълняват се от ляво на дясно
- **Дясно асоциативни** - изпълняват се от дясно на ляво  
  
**Пример**
- Ляво асоциативни операции `a + b - c` се изпълнява като `(a + b) - c`
- Дясно асоциативни операции `a = b = c` се изпълнява като `a = (b = c)`

**Оператори които не могат да се предефинират**  
- оператор за избор на компоненти `.`
- оператор за избор на компоненти на клас чрез указател `*`
- оператор за област на действие `::`
- троен оператор `?:`
- оператор `sizeof`

## Операторни функции

**Операциите в C++ могат да бъдат предефинирани като**
- **обикновенни функции, извън дефиницията на кой да е клас
- **член-функции** на клас

**Предефиниране като функция**
```
<тип на резултат> operator<знак на операция> (<параметри: един или два>)
{
  <тяло>
}
```
**Пример**
```
int operator-(const Time&lhs, const Time&b rhs)
{
  return lhs.seconds_from(rhs);
}
```

**Операторни член-функции**  
  
 - Операциите могат да бъдат предефинирани и като **член-функции**
 - Например, препоръчва се различните форми за присвояване да бъдат дефинирани като член-функции
 - За повечето оператори програмистът избира начина на предефиниране - като функция или като член-функция

**Синтаксисът за извикване на оператора е един и същ (единствено и само чрез знака на операцията),**  
**независимо дали е предефиниран като функция или член-функция**  
  
 **При избора дали даден оператор да се предефинира като глобална функция или член-функция, трябва да се има предвид**
 - Функция, която не е член на класа, обикновено **няма достъп до частните елементи на класа** (освен ако не е приятел на класа,  
 докато член-функцията има
 - Стандартните типове (напр. **int** или **double**) могат да бъдат само десни операнди в **член-функция**,  
 но могат да бъдат и **леви операнди** в **глобално** предефинирана операция.
 
 **!!! Използвайте предефиниране на операторите чрез глобални функции, когато левият операнд е от стандартен тип**

## Предефиниране - функции-приятели или член-функции

**Предефиниране като член-функции или функции-приятели**
- Когато предефинирането на оператор изисква достъп до **private** или **protected** компоненти на класа
- Когато първият (или единственият) операнд на оператора е обект на класа или псевдоним на обект от класа

**Предефиниране като член-функции, задължително за**
- Операторите `()`, `[]`, `->`, `=`
  
 **Предефиниране като глобални функции-приятели**
 - Ако първият или единствен операнд е обект на друг клас, или псевдоним на обект на друг клас или е от стандартен тип (int, double, char . . .)  
   
  **Пример**
  Операторите `>>` и `<<` се предефинират като функции-приятели, тъй като първи операнд за тях е поток
  
  ## Предефиниране на унарни оператори
  Унарен оператор може да се предефинира, като
  - Нестатична член-функция на класа без явно указан аргумент
  - Като функция-приятел с един аргумент, който трябва да е или обект на класа, или псевдоним на обект на класа
